# 前后端使��手册

本文档为“软件许可证分析看板”项目的使用者和维护者提供详细的操作指南。

---

## 一、 前端用户使用手册

本部分面向所有需要使用此工具进行日志分析的普通用户（如IT管理员、部门经理等）。

### 1.1 功能入口

在浏览器中打开提供给您的网址（例如 `http://localhost:8000`）。您将看到工具的主界面。

### 1.2 操作步骤

1.  **准备日志文件**:
    *   在您的许可证服务器或客户端电脑上，执行许可证查询命令（例如 `lmstat -a`）。
    *   将命令输出的**全部内容**复制并保存到一个标准的文本文档中，后缀名为 `.txt`。

2.  **上传文件**:
    *   在工具页面上，点击蓝色的 **[选择日志文件]** 按钮。
    *   在弹出的文件选择窗口中，找到并选择您刚刚保存的 `.txt` 日志文件。

3.  **查看分析结果**:
    *   文件选择后，程序会自动上传并进行分析。页面会短暂显示“正在解析，请稍候...”。
    *   分析完成后，结果会自动呈现在页面上，主要包括两个部分：

    *   **许可证使用概览 (柱状图)**:
        *   此图表直观地展示了每个许可证功能模块（Feature）的“总数”与“在用数”。
        *   您可以将鼠标悬停在任何一个柱子上，查看其精确的数值。
        *   对于数值差异巨大的情况，图表Y轴采用了对数标尺，以便同时看清大数值和小数值。
        *   如果功能模块名称过长，标签会自动倾斜以避免重叠。

    *   **在用许可证详情 (数据表格)**:
        *   此表格详细列出了**每一个正在被使用**的许可证的详细信息。
        *   **搜索**: 您可以在表格上方的搜索框中，输入“功能模块名称”或“使用者”的任意关键字，表格内容会实时筛选出匹配的条目。
        *   **排序**: 您可以点击任意一个表头（如“功能模块”、“使用者”、“已使用时长”等），对表格数据进行升序或降序排列。再次点击可切换排序方向。
        *   **动态时长**: “已使用时长”会每分钟自动更新一次，无需刷新页面。

---

## 二、 后端技术维护手册

本部分面向需要部署、运行和维护此工具的技术人员。

### 2.1 技术栈

*   **语言**: Python 3
*   **Web框架**: Flask
*   **核心逻辑**: 位于 `backend/app.py` 中的 `parse_lmstat_log` 函数。

### 2.2 部署与运行

#### 2.2.1 首次部署

1.  **环境准备**: 确保服务器已安装 Python 3 和 pip。
2.  **复制文件**: 将 `backend` 文件夹完整复制到服务器的目标位置。
3.  **安装依赖**:
    *   进入 `backend` 目录。
    *   建议创建并激活Python虚拟环境，以隔离项目依赖：
        ```bash
        # 创建虚拟环境
        python -m venv venv
        
        # 激活虚拟环境
        # Windows:
        .\venv\Scripts\activate
        # Linux/macOS:
        source venv/bin/activate
        ```
    *   在激活的虚拟环境中，安装所有必需的库：
        ```bash
        pip install -r requirements.txt
        ```

#### 2.2.2 启动服务

*   **开发/测试环境启动**:
    *   确保您处于 `backend` 目录下且虚拟环境已激活。
    *   直接运行 `app.py`:
        ```bash
        python app.py
        ```
    *   服务将默认在 `http://127.0.0.1:5001` 上启动。

*   **生产环境启动 (推荐)**:
    *   为了性能和稳定性，建议使用生产级的 WSGI 服务器（如 Gunicorn）来运行。
    *   首先安装 Gunicorn: `pip install gunicorn`
    *   通过 Gunicorn 启动应用 (以4个工作进程为例):
        ```bash
        gunicorn --workers 4 --bind 0.0.0.0:5001 app:app
        ```
    *   通常建议在 Gunicorn 前面再配置一个反向代理服务器（如 Nginx），用于处理静态资源、HTTPS加密和负载均衡。

### 2.3 代码维护

*   **核心解析逻辑**:
    *   所有对 `lmstat` 日志的解析逻辑都集中在 `backend/app.py` 文件的 `parse_lmstat_log` 函数中。
    *   解析的核心是依赖于文件顶部的几个**正则表达式** (`FEATURE_LINE_RE`, `ISSUED_IN_USE_RE`, `USER_LINE_RE`)。

*   **如何处理新的日志格式**:
    *   如果遇到一种新的、无法被当前程序解析的 `lmstat` 日志格式，您需要：
    1.  分析新日志的文本规律。
    2.  修改 `backend/app.py` 中对应的正则表达式，使其能够兼容新的格式。
    3.  重启后端服务使修改生效。

*   **API接口**:
    *   项目只提供一个API接口：`POST /api/analyze`。
    *   它接收一个名为 `file` 的文件上传字段。
    *   成功时返回 `200 OK` 和分析结果的 JSON 数组。
    *   失败时返回 `400` 或 `500` 错误码和包含错误信息的 JSON 对象。